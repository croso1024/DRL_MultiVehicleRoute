# StudyCase 實驗設計計畫

## 項目說明 

本實驗希望藉由真實場域地圖(NTU , Taipei) 進行Dynamic & Stochastic Vehicle Routing Problem 的驗證。 
具體的實驗方法為建立一塊場域地圖交由模型進行推論 ， 其中場域地圖的需求會隨時間進行改變 ，即在規劃完成到車子出動後T時刻 ，會將車輛經由在T時刻時所在的位置以及新加入的需求重新做路徑規劃 。 , 此一場域地圖的新需求產生為隨機但有限量 , 而整體的Cost則是紀錄車子實際移動的距離 , 在最終完成所有節點後總結。 

總結此實驗欲建構之動態隨機路徑規劃場景如下: 
1. 使用台大or台北市街區地圖作為路徑規劃的場地 
2. 隨著車輛實際在場域進行任務的過程 , 會以隨機或在固定時刻(TBD) 加入新的需求,以及更新交通狀況 ,並取得在該時刻各車輛之狀態 , 以此產生新的路網, 車隊狀態
3. 每一次更新路網後 , 保存所有車輛在上一個路網狀態下所移動的距離並累積Cost 
4. 完成所有節點後 , 計算Total Cost 





### OSM地圖 Requirement 
在本實驗中使用到OSM地圖分為兩個部份 , **產生路網狀態與變化** 以及 **畫出模型所規劃之路徑** 兩大部份 , 以下分此兩部份定義所需要完成之功能 

#### 產生路網狀態與變化
此部份功能包含但不限於 : 

- 使用節點集建立OSM地圖的距離矩陣
	random factor的產生會等到總距離矩陣產生後 , 再轉換為Graph-data的過程中加入 , 目前就是隨機加入follow data-generator的方式 , 另外加入random-factor的部份 , 在後續更新時前一步已經有的random-factor應該就不會作太大的改變
	
- 接受模型輸出的多車輛路徑 ，以及經過時間T, 返回各車輛的新位置
	目前想到就算有新的車輛的位置要一同轉換成Graph-data是一個難點 , 比較好的解法應該是加入Distance matrix給降維一起做轉換 , 再取出代表車輛的那些部份座標
	
- 在已經有的距離矩陣以及點集合中 , 加入新的節點  
	應該會和在經過時間T時一同更新 ，即從還沒發出需求的節點中隨機Sample,n個節點 , 加入Request-list後重新計算距離矩陣  


總之用來代表路網的距離矩陣會是由  node-list組成包括 :
**初始狀態 :**   [ 已知需求 ]
**任務開始後 :**  [ 已知需求(只保留未完成)  |  此時刻新加入的需求   |   所有車輛所在的位置    ]
接著將其轉換成Coordinate後 , 使用index區分那些部份是Request , 哪些部份是vehicle-pos  , 這樣子的scheme也容易配合OR-tools使用  


#### 畫出模型所規劃之路徑 

應該要在模你的環境中加入Recorder , 紀錄由初始狀態開始每一個時刻 , **包含每一次更新路網狀態時 , 紀錄每一台車輛已經走過得路徑(即完成的節點) ,更新前原始的模型預測路徑,, 並紀錄該時刻的車子累積Cost,capacity狀態**   




